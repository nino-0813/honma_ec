# 管理画面 Basic認証 実装ガイド

## 概要

管理画面（`/#/admin`）へのアクセス時に Basic認証を要求する機能を実装しました。

## 実装方法

### 1. ファイル構成

- `api/admin-auth.ts`: Vercel Edge Function（Basic認証を実装）
- `vercel.json`: `/admin` へのリクエストを Edge Function にルーティング

### 2. 動作フロー

1. ユーザーが `/admin` にアクセス
2. `vercel.json` の `rewrites` により、リクエストが `api/admin-auth.ts` にルーティング
3. Edge Function で Basic認証をチェック
4. 認証成功: `index.html` にリダイレクト（クライアントサイドで `/#/admin` にルーティング）
5. 認証失敗: 401 Unauthorized を返し、ブラウザが Basic認証ダイアログを表示

### 3. 環境変数の設定

Vercel ダッシュボードで以下の環境変数を設定してください：

```
ADMIN_BASIC_AUTH_USER=your_admin_username
ADMIN_BASIC_AUTH_PASS=your_admin_password
```

**重要:**
- `VITE_` プレフィックスを付けないでください（サーバーサイドでのみ使用）
- 本番環境（Production）でのみ設定することを推奨
- 開発環境では設定しないと認証がスキップされます（ローカル開発が容易）

### 4. 設定手順

1. Vercel ダッシュボードにログイン
2. プロジェクトを選択
3. Settings > Environment Variables に移動
4. 以下の環境変数を追加：
   - `ADMIN_BASIC_AUTH_USER`: 管理画面のユーザー名
   - `ADMIN_BASIC_AUTH_PASS`: 管理画面のパスワード
5. 環境を選択（Production のみ推奨）
6. Save をクリック
7. **再デプロイを実行**（環境変数の変更を反映するため）

### 5. 動作確認

1. 環境変数を設定して再デプロイ
2. 本番環境の `/admin` にアクセス
3. Basic認証ダイアログが表示されることを確認
4. 設定したユーザー名・パスワードでログイン
5. 管理画面が表示されることを確認

### 6. 注意事項

- **既存の Supabase 認証は変更されていません**
  - Basic認証は管理画面へのアクセス時にのみ要求されます
  - 管理画面内の Supabase 認証（ログイン画面）は従来通り動作します

- **フロントコードへの影響**
  - フロントコードは一切変更されていません
  - クライアントサイドのルーティング（`/#/admin`）は従来通り動作します

- **開発環境**
  - 環境変数が設定されていない場合、認証はスキップされます
  - ローカル開発時は `vercel dev` を使用するか、環境変数を設定してください

### 7. トラブルシューティング

#### Basic認証ダイアログが表示されない

- 環境変数が正しく設定されているか確認
- 再デプロイを実行しているか確認
- Vercel ダッシュボードの Functions タブでエラーログを確認

#### 認証後も管理画面にアクセスできない

- ブラウザのキャッシュをクリア
- シークレットモードで試す
- Vercel ダッシュボードの Functions タブでエラーログを確認

#### 開発環境で認証が要求される

- 環境変数を Preview/Development 環境に設定していないか確認
- または、ローカル開発時は環境変数を設定しない

## セキュリティに関する注意

- Basic認証は平文で送信されるため、HTTPS を使用することが重要です
- Vercel の本番環境は自動的に HTTPS が有効になっています
- 強力なパスワードを設定してください
- 定期的にパスワードを変更することを推奨します

